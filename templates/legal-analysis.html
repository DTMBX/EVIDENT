<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Analysis Dashboard - BarberX Legal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a1a1a;
            --accent: #d4af37;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
        }
        
        body {
            background: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary) 0%, #2d2d2d 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .tool-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            transition: transform 0.3s;
        }
        
        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .tool-icon {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: 1rem;
        }
        
        .analysis-results {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 2rem;
            display: none;
        }
        
        .violation-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .severity-critical {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .severity-high {
            background: #fed7aa;
            color: #9a3412;
        }
        
        .severity-medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .severity-low {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .case-law-citation {
            background: #f3f4f6;
            padding: 0.75rem 1rem;
            border-left: 4px solid var(--accent);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .motion-card {
            background: #fffef9;
            border: 2px solid var(--accent);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .stat-box {
            text-align: center;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-analyze {
            background: var(--accent);
            color: var(--primary);
            border: none;
            padding: 0.75rem 2rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .btn-analyze:hover {
            background: #b8941f;
            transform: scale(1.05);
        }
        
        .spinner-border {
            width: 2rem;
            height: 2rem;
            border-width: 3px;
        }
        
        .compliance-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .status-compliant {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-questionable {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-non-compliant {
            background: #fee2e2;
            color: #991b1b;
        }
        
        textarea {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .evidence-field {
            margin-bottom: 1rem;
        }
        
        .evidence-field label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-gavel"></i> Legal Analysis Dashboard</h1>
                    <p class="mb-0">Constitutional Rights Violation Scanner & Statutory Compliance Checker</p>
                </div>
                <a href="/dashboard" class="btn btn-light">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Tool Selection -->
        <div class="row">
            <div class="col-md-4">
                <div class="tool-card text-center">
                    <div class="tool-icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <h3>Violation Scanner</h3>
                    <p class="text-muted">Scan transcripts for Miranda, Fourth Amendment, Brady/Giglio violations</p>
                    <button class="btn btn-analyze" onclick="showViolationScanner()">
                        Use Scanner
                    </button>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="tool-card text-center">
                    <div class="tool-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Compliance Checker</h3>
                    <p class="text-muted">Check evidence against Federal Rules of Evidence & chain of custody</p>
                    <button class="btn btn-analyze" onclick="showComplianceChecker()">
                        Check Compliance
                    </button>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="tool-card text-center">
                    <div class="tool-icon">
                        <i class="fas fa-microscope"></i>
                    </div>
                    <h3>Combined Analysis</h3>
                    <p class="text-muted">Run both tools simultaneously for comprehensive legal analysis</p>
                    <button class="btn btn-analyze" onclick="showCombinedAnalysis()">
                        Full Analysis
                    </button>
                </div>
            </div>
        </div>

        <!-- Violation Scanner -->
        <div id="violation-scanner" class="tool-card" style="display: none;">
            <h2><i class="fas fa-balance-scale"></i> Violation Scanner</h2>
            <p class="text-muted">Analyze transcripts for constitutional rights violations</p>
            
            <div class="mb-3">
                <label for="transcript">Transcript Text</label>
                <textarea id="transcript" class="form-control" rows="10" placeholder="Paste BWC transcript, interview, or interrogation text here..."></textarea>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label>Evidence ID</label>
                    <input type="text" id="evidence-id" class="form-control" placeholder="BWC-2024-001">
                </div>
                <div class="col-md-6">
                    <label>Case Number</label>
                    <input type="text" id="case-number" class="form-control" placeholder="CR-2024-123">
                </div>
            </div>
            
            <button class="btn btn-analyze" onclick="scanViolations()">
                <i class="fas fa-search"></i> Scan for Violations
            </button>
        </div>

        <!-- Compliance Checker -->
        <div id="compliance-checker" class="tool-card" style="display: none;">
            <h2><i class="fas fa-check-circle"></i> Compliance Checker</h2>
            <p class="text-muted">Verify evidence meets legal standards</p>
            
            <div class="evidence-field">
                <label>Evidence Type</label>
                <select id="evidence-type" class="form-control">
                    <option value="video">Video/BWC</option>
                    <option value="audio">Audio Recording</option>
                    <option value="photograph">Photograph</option>
                    <option value="document">Document</option>
                    <option value="digital">Digital Evidence</option>
                    <option value="social_media">Social Media</option>
                </select>
            </div>
            
            <div class="evidence-field">
                <label>Evidence ID</label>
                <input type="text" id="comp-evidence-id" class="form-control" placeholder="EVID-2024-001">
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-check mb-3">
                        <input type="checkbox" id="is-original" class="form-check-input">
                        <label class="form-check-label" for="is-original">Is Original (not copy)</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-check mb-3">
                        <input type="checkbox" id="authenticated" class="form-check-input">
                        <label class="form-check-label" for="authenticated">Has been authenticated</label>
                    </div>
                </div>
            </div>
            
            <div class="evidence-field">
                <label>Content/Description</label>
                <textarea id="evidence-content" class="form-control" rows="4" placeholder="Evidence description or statement content..."></textarea>
            </div>
            
            <button class="btn btn-analyze" onclick="checkCompliance()">
                <i class="fas fa-clipboard-check"></i> Check Compliance
            </button>
        </div>

        <!-- Combined Analysis -->
        <div id="combined-analysis" class="tool-card" style="display: none;">
            <h2><i class="fas fa-microscope"></i> Combined Analysis</h2>
            <p class="text-muted">Comprehensive legal analysis with violations + compliance</p>
            
            <div class="mb-3">
                <label for="combined-transcript">Transcript Text</label>
                <textarea id="combined-transcript" class="form-control" rows="8" placeholder="Paste transcript here..."></textarea>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-4">
                    <label>Evidence ID</label>
                    <input type="text" id="combined-evidence-id" class="form-control">
                </div>
                <div class="col-md-4">
                    <label>Case Number</label>
                    <input type="text" id="combined-case-number" class="form-control">
                </div>
                <div class="col-md-4">
                    <label>Evidence Type</label>
                    <select id="combined-type" class="form-control">
                        <option value="video">Video/BWC</option>
                        <option value="audio">Audio</option>
                        <option value="document">Document</option>
                    </select>
                </div>
            </div>
            
            <button class="btn btn-analyze" onclick="runCombinedAnalysis()">
                <i class="fas fa-play"></i> Run Full Analysis
            </button>
        </div>

        <!-- Results Area -->
        <div id="results" class="analysis-results">
            <div id="loading" class="text-center py-5" style="display: none;">
                <div class="spinner-border text-warning" role="status"></div>
                <p class="mt-3">Analyzing evidence...</p>
            </div>
            
            <div id="results-content"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showViolationScanner() {
            hideAllTools();
            document.getElementById('violation-scanner').style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }
        
        function showComplianceChecker() {
            hideAllTools();
            document.getElementById('compliance-checker').style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }
        
        function showCombinedAnalysis() {
            hideAllTools();
            document.getElementById('combined-analysis').style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }
        
        function hideAllTools() {
            document.getElementById('violation-scanner').style.display = 'none';
            document.getElementById('compliance-checker').style.display = 'none';
            document.getElementById('combined-analysis').style.display = 'none';
        }
        
        async function scanViolations() {
            const transcript = document.getElementById('transcript').value;
            const evidenceId = document.getElementById('evidence-id').value;
            const caseNumber = document.getElementById('case-number').value;
            
            if (!transcript) {
                alert('Please provide a transcript to analyze');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch('/api/legal/scan-violations', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        transcript: transcript,
                        context: {
                            evidence_id: evidenceId,
                            case_number: caseNumber
                        }
                    })
                });
                
                const data = await response.json();
                displayViolationResults(data);
            } catch (error) {
                hideLoading();
                alert('Error analyzing transcript: ' + error.message);
            }
        }
        
        async function checkCompliance() {
            const evidenceId = document.getElementById('comp-evidence-id').value;
            const evidenceType = document.getElementById('evidence-type').value;
            const isOriginal = document.getElementById('is-original').checked;
            const authenticated = document.getElementById('authenticated').checked;
            const content = document.getElementById('evidence-content').value;
            
            showLoading();
            
            try {
                const response = await fetch('/api/legal/check-compliance', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        evidence: {
                            id: evidenceId,
                            type: evidenceType,
                            is_original: isOriginal,
                            authenticated: authenticated,
                            content: content,
                            custody_log: []
                        }
                    })
                });
                
                const data = await response.json();
                displayComplianceResults(data);
            } catch (error) {
                hideLoading();
                alert('Error checking compliance: ' + error.message);
            }
        }
        
        async function runCombinedAnalysis() {
            const transcript = document.getElementById('combined-transcript').value;
            const evidenceId = document.getElementById('combined-evidence-id').value;
            const caseNumber = document.getElementById('combined-case-number').value;
            const evidenceType = document.getElementById('combined-type').value;
            
            if (!transcript) {
                alert('Please provide a transcript');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch('/api/legal/combined-analysis', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        transcript: transcript,
                        evidence: {
                            id: evidenceId,
                            case_number: caseNumber,
                            type: evidenceType,
                            custody_log: []
                        }
                    })
                });
                
                const data = await response.json();
                displayCombinedResults(data);
            } catch (error) {
                hideLoading();
                alert('Error running analysis: ' + error.message);
            }
        }
        
        function showLoading() {
            document.getElementById('results').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results-content').innerHTML = '';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        function displayViolationResults(data) {
            hideLoading();
            
            let html = `
                <h2><i class="fas fa-exclamation-triangle"></i> Violation Scan Results</h2>
                <p class="text-muted">Evidence ID: ${data.evidence_id}</p>
                
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-box">
                            <div class="stat-value">${data.total_violations}</div>
                            <div class="stat-label">Total Violations</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <div class="stat-value text-danger">${data.violations_by_severity.critical}</div>
                            <div class="stat-label">Critical</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <div class="stat-value text-warning">${data.violations_by_severity.high}</div>
                            <div class="stat-label">High</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <div class="stat-value text-info">${data.violations_by_severity.medium}</div>
                            <div class="stat-label">Medium</div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <strong>Summary:</strong> ${data.summary}
                </div>
            `;
            
            if (data.critical_violations.length > 0) {
                html += '<h3 class="mt-4">üö® Critical Violations</h3>';
                data.critical_violations.forEach(v => {
                    html += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5>${v.title} <span class="violation-badge severity-critical">CRITICAL</span></h5>
                                <p><strong>Type:</strong> ${v.type}</p>
                                <p>${v.description}</p>
                                <p><strong>Legal Basis:</strong> ${v.legal_basis}</p>
                                <div class="alert alert-warning">
                                    <strong>Recommended Action:</strong> ${v.recommended_action}
                                </div>
                                <div class="case-law-citation">
                                    <strong>Case Law Support:</strong><br>
                                    ${v.case_law_support.join('<br>')}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            if (data.recommended_motions.length > 0) {
                html += '<h3 class="mt-4">üìù Recommended Motions</h3>';
                data.recommended_motions.forEach(motion => {
                    html += `
                        <div class="motion-card">
                            <h5>${motion.motion_type}</h5>
                            <p><strong>Basis:</strong> ${motion.basis}</p>
                            <p><strong>Priority:</strong> <span class="badge bg-danger">${motion.priority.toUpperCase()}</span></p>
                            <p><strong>Violations:</strong> ${motion.violations}</p>
                        </div>
                    `;
                });
            }
            
            document.getElementById('results-content').innerHTML = html;
        }
        
        function displayComplianceResults(data) {
            hideLoading();
            
            let statusClass = data.overall_status.toLowerCase().replace('_', '-');
            
            let html = `
                <h2><i class="fas fa-clipboard-check"></i> Compliance Check Results</h2>
                <p class="text-muted">Evidence ID: ${data.evidence_id} | Type: ${data.evidence_type}</p>
                
                <div class="alert alert-${statusClass === 'compliant' ? 'success' : 'warning'}">
                    <strong>Overall Status:</strong> 
                    <span class="compliance-status status-${statusClass}">${data.overall_status}</span>
                </div>
                
                <p>${data.summary}</p>
                
                <h3 class="mt-4">Chain of Custody</h3>
                <div class="alert alert-${data.chain_of_custody.status === 'PASSED' ? 'success' : 'danger'}">
                    <strong>Status:</strong> ${data.chain_of_custody.status}<br>
                    ${data.chain_of_custody.recommendation}
                </div>
            `;
            
            if (data.non_compliant_issues.length > 0) {
                html += '<h3 class="mt-4">‚ö†Ô∏è Non-Compliant Issues</h3>';
                data.non_compliant_issues.forEach(issue => {
                    html += `
                        <div class="card mb-3 border-danger">
                            <div class="card-body">
                                <h5>${issue.title} <span class="badge bg-danger">${issue.rule_number}</span></h5>
                                <p>${issue.description}</p>
                                <div class="alert alert-warning">
                                    <strong>Remedy:</strong> ${issue.remedy}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            if (data.recommendations.length > 0) {
                html += '<h3 class="mt-4">Recommendations</h3><ul>';
                data.recommendations.forEach(rec => {
                    html += `<li>${rec}</li>`;
                });
                html += '</ul>';
            }
            
            document.getElementById('results-content').innerHTML = html;
        }
        
        function displayCombinedResults(data) {
            hideLoading();
            
            let html = `
                <h2><i class="fas fa-microscope"></i> Combined Legal Analysis</h2>
                <p class="text-muted">Evidence ID: ${data.evidence_id}</p>
                
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="stat-box">
                            <div class="stat-value">${data.overall_assessment.total_issues}</div>
                            <div class="stat-label">Total Issues Found</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-box">
                            <div class="stat-value text-danger">${data.overall_assessment.critical_violations}</div>
                            <div class="stat-label">Critical Violations</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-box">
                            <div class="stat-value text-warning">${data.overall_assessment.non_compliant_count}</div>
                            <div class="stat-label">Non-Compliant Items</div>
                        </div>
                    </div>
                </div>
                
                <h3>Violation Analysis</h3>
                <p>${data.violations.summary}</p>
                
                <h3 class="mt-4">Compliance Analysis</h3>
                <p>${data.compliance.summary}</p>
                
                <h3 class="mt-4">Recommended Actions</h3>
                <ol>
            `;
            
            data.overall_assessment.recommended_actions.forEach(action => {
                if (typeof action === 'object') {
                    html += `<li><strong>${action.motion_type}:</strong> ${action.basis} (${action.priority} priority)</li>`;
                } else {
                    html += `<li>${action}</li>`;
                }
            });
            
            html += '</ol>';
            
            document.getElementById('results-content').innerHTML = html;
        }
    </script>
</body>
</html>
