<!-- htmlhint-disable doctype-first -->
<!-- Reusable Navigation Component -->
<nav class="site-nav">
  <div class="nav-container">
    <!-- Logo -->
    <a href="/" class="nav-logo">
      <div class="barber-pole-icon" aria-hidden="true">
        <div class="pole-stripe"></div>
        <div class="pole-stripe"></div>
        <div class="pole-stripe"></div>
      </div>
      <span class="nav-brand">BarberX</span>
    </a>

    <!-- Mobile Toggle -->
    <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
      <span class="toggle-line"></span>
      <span class="toggle-line"></span>
      <span class="toggle-line"></span>
    </button>

    <!-- Navigation Links -->
    <div class="nav-menu" id="navMenu">
      <ul class="nav-links">
        <li class="nav-item">
          <a href="/dashboard" class="nav-link">Dashboard</a>
        </li>
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle">
            Tools
            <svg
              class="dropdown-icon"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="6 9 12 15 18 9" />
            </svg>
          </a>
          <ul class="dropdown-menu">
            <li><a href="/tools/transcript">Transcript Analysis</a></li>
            <li><a href="/tools/timeline">Timeline Builder</a></li>
            <li><a href="/tools/entity-extract">Entity Extraction</a></li>
            <li><a href="/tools/discrepancy">Discrepancy Detector</a></li>
            <li><a href="/tools/batch">Batch Upload</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a href="/docs" class="nav-link">Docs</a>
        </li>
        <li class="nav-item">
          <a href="/pricing" class="nav-link">Pricing</a>
        </li>
        <li class="nav-item">
          <a href="/about" class="nav-link">About</a>
        </li>
      </ul>

      <!-- Auth Buttons -->
      <div class="nav-auth">
        {% if current_user and current_user.is_authenticated %}
        <div class="user-menu">
          <button class="user-menu-toggle" id="userMenuToggle">
            <div class="user-avatar">
              {{ (current_user.full_name or current_user.email or 'U')[0]|upper
              }}
            </div>
            <span class="user-name"
              >{{ current_user.full_name or current_user.email }}</span
            >
          </button>
          <div class="user-dropdown" id="userDropdown">
            <div class="user-info">
              <div class="user-email">{{ current_user.email }}</div>
              <div class="user-tier">{{ current_user.tier_name }}</div>
            </div>
            <hr class="dropdown-divider" />
            <a href="/dashboard" class="dropdown-item">Dashboard</a>
            <a href="/api" class="dropdown-item">API Keys</a>
            <a href="/settings" class="dropdown-item">Settings</a>
            <hr class="dropdown-divider" />
            <a href="/logout" class="dropdown-item text-danger">Logout</a>
          </div>
        </div>
        {% else %}
        <a href="/login" class="btn-nav btn-nav-secondary">Sign In</a>
        <a href="/register" class="btn-nav btn-nav-primary">Get Started</a>
        {% endif %}
      </div>
    </div>
  </div>
</nav>

<style>
  .site-nav {
    background: #ffffff;
    border-bottom: 1px solid #e2e8f0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .nav-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 64px;
  }

  .nav-logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    color: #1e293b;
    font-weight: 700;
    font-size: 1.25rem;
  }

  .barber-pole-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(
      45deg,
      #c41e3a 25%,
      #ffffff 25%,
      #ffffff 50%,
      #c41e3a 50%,
      #c41e3a 75%,
      #ffffff 75%,
      #ffffff
    );
    background-size: 8px 8px;
    border-radius: 4px;
    position: relative;
    overflow: hidden;
  }

  .nav-brand {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
  }

  .nav-toggle {
    display: none;
    flex-direction: column;
    gap: 4px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
  }

  .toggle-line {
    width: 24px;
    height: 2px;
    background: #475569;
    border-radius: 2px;
    transition: all 0.3s;
  }

  .nav-menu {
    display: flex;
    align-items: center;
    gap: 2rem;
    flex: 1;
    justify-content: flex-end;
  }

  .nav-links {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 0.5rem;
  }

  .nav-item {
    position: relative;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 1rem;
    color: #475569;
    text-decoration: none;
    font-weight: 500;
    border-radius: 6px;
    transition: all 0.2s;
  }

  .nav-link:hover {
    background: #f1f5f9;
    color: #1e293b;
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    list-style: none;
    margin: 0.5rem 0 0 0;
    padding: 0.5rem 0;
    min-width: 200px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s;
  }

  .dropdown:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .dropdown-menu li a {
    display: block;
    padding: 0.75rem 1rem;
    color: #475569;
    text-decoration: none;
    transition: background 0.2s;
  }

  .dropdown-menu li a:hover {
    background: #f1f5f9;
    color: #1e293b;
  }

  .nav-auth {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .btn-nav {
    padding: 0.5rem 1.25rem;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s;
    border: 1px solid transparent;
  }

  .btn-nav-secondary {
    color: #475569;
    border-color: #e2e8f0;
  }

  .btn-nav-secondary:hover {
    background: #f1f5f9;
  }

  .btn-nav-primary {
    background: #c41e3a;
    color: #ffffff;
  }

  .btn-nav-primary:hover {
    background: #a01729;
  }

  .user-menu {
    position: relative;
  }

  .user-menu-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .user-menu-toggle:hover {
    background: #e2e8f0;
  }

  .user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #c41e3a, #1e3a8a);
    color: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
  }

  .user-name {
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: #1e293b;
  }

  .user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-top: 0.5rem;
    padding: 0.5rem 0;
    min-width: 220px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s;
  }

  .user-menu:hover .user-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .user-info {
    padding: 0.75rem 1rem;
  }

  .user-email {
    font-size: 0.875rem;
    color: #475569;
  }

  .user-tier {
    font-size: 0.75rem;
    color: #c41e3a;
    font-weight: 600;
    text-transform: uppercase;
    margin-top: 0.25rem;
  }

  .dropdown-divider {
    margin: 0.5rem 0;
    border: none;
    border-top: 1px solid #e2e8f0;
  }

  .dropdown-item {
    display: block;
    padding: 0.75rem 1rem;
    color: #475569;
    text-decoration: none;
    transition: background 0.2s;
  }

  .dropdown-item:hover {
    background: #f1f5f9;
  }

  .dropdown-item.text-danger {
    color: #dc2626;
  }

  /* Mobile Improvements */
  @media (max-width: 768px) {
    .nav-toggle {
      display: flex;
      z-index: 1001;
      position: relative;
    }

    .nav-toggle.active .toggle-line:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .nav-toggle.active .toggle-line:nth-child(2) {
      opacity: 0;
    }

    .nav-toggle.active .toggle-line:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }

    .nav-menu {
      position: fixed;
      top: 64px;
      left: 0;
      right: 0;
      bottom: 0;
      background: #ffffff;
      flex-direction: column;
      align-items: stretch;
      padding: 1.5rem;
      border-top: 1px solid #e2e8f0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateX(100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .nav-menu.active {
      transform: translateX(0);
      opacity: 1;
      visibility: visible;
    }

    .nav-links {
      flex-direction: column;
      width: 100%;
      gap: 0.25rem;
    }

    .nav-item {
      width: 100%;
    }

    .nav-link {
      width: 100%;
      padding: 1rem 1.25rem;
      font-size: 1rem;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-link:active {
      background: #e2e8f0;
    }

    .dropdown-menu {
      position: static;
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
      box-shadow: none;
      border: none;
      border-left: 3px solid #c41e3a;
      margin: 0;
      padding-left: 1rem;
      background: #f8fafc;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dropdown.active .dropdown-menu {
      max-height: 500px;
    }

    .dropdown-menu li a {
      padding: 0.875rem 1rem;
      min-height: 44px;
      display: flex;
      align-items: center;
    }

    .nav-auth {
      flex-direction: column;
      width: 100%;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e2e8f0;
      gap: 0.75rem;
    }

    .btn-nav {
      width: 100%;
      text-align: center;
      padding: 0.875rem 1.25rem;
      font-size: 1rem;
      min-height: 48px;
    }

    .user-menu {
      width: 100%;
    }

    .user-menu-toggle {
      width: 100%;
      justify-content: space-between;
      padding: 0.875rem 1rem;
      min-height: 48px;
    }

    .user-dropdown {
      position: static;
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
      box-shadow: none;
      margin-top: 0.75rem;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .user-menu.active .user-dropdown {
      max-height: 400px;
    }

    .dropdown-item {
      padding: 0.875rem 1rem;
      min-height: 44px;
    }
  }

  /* Tablet Improvements */
  @media (min-width: 769px) and (max-width: 1024px) {
    .nav-container {
      padding: 0 1.25rem;
    }

    .nav-links {
      gap: 0.25rem;
    }

    .nav-link {
      padding: 0.5rem 0.75rem;
      font-size: 0.9rem;
    }

    .user-name {
      display: none;
    }
  }

  /* Touch Optimization */
  @media (hover: none) and (pointer: coarse) {
    .nav-link,
    .dropdown-item,
    .user-menu-toggle,
    .btn-nav {
      min-height: 48px;
      min-width: 48px;
    }

    .nav-link:active,
    .dropdown-item:active {
      background: #e2e8f0;
      transform: scale(0.98);
    }
  }

  /* Accessibility Improvements */
  .nav-toggle:focus,
  .nav-link:focus,
  .btn-nav:focus,
  .user-menu-toggle:focus {
    outline: 2px solid #c41e3a;
    outline-offset: 2px;
  }

  @media (prefers-reduced-motion: reduce) {
    .nav-menu,
    .toggle-line,
    .dropdown-menu,
    .user-dropdown,
    .nav-link,
    .dropdown-item {
      transition: none;
    }
  }
</style>

<script>
  // Enhanced Mobile Navigation with Accessibility
  document.addEventListener("DOMContentLoaded", function () {
    const navToggle = document.getElementById("navToggle");
    const navMenu = document.getElementById("navMenu");
    const body = document.body;

    // Toggle mobile menu
    if (navToggle && navMenu) {
      navToggle.addEventListener("click", function () {
        const isActive = navMenu.classList.toggle("active");
        navToggle.classList.toggle("active");

        // Update ARIA attributes
        navToggle.setAttribute("aria-expanded", isActive);
        navMenu.setAttribute("aria-hidden", !isActive);

        // Prevent body scroll when menu is open
        if (isActive) {
          body.style.overflow = "hidden";
        } else {
          body.style.overflow = "";
        }
      });
    }

    // Handle dropdown toggles on mobile
    const dropdowns = document.querySelectorAll(".dropdown");
    dropdowns.forEach((dropdown) => {
      const toggle = dropdown.querySelector(".dropdown-toggle");
      if (toggle) {
        toggle.addEventListener("click", function (e) {
          if (window.innerWidth <= 768) {
            e.preventDefault();
            dropdown.classList.toggle("active");

            // Close other dropdowns
            dropdowns.forEach((other) => {
              if (other !== dropdown) {
                other.classList.remove("active");
              }
            });
          }
        });
      }
    });

    // Handle user menu toggle on mobile
    const userMenuToggle = document.getElementById("userMenuToggle");
    const userMenu = userMenuToggle?.closest(".user-menu");

    if (userMenuToggle && userMenu) {
      userMenuToggle.addEventListener("click", function () {
        if (window.innerWidth <= 768) {
          userMenu.classList.toggle("active");
        }
      });
    }

    // Close mobile menu on resize to desktop
    window.addEventListener("resize", function () {
      if (window.innerWidth > 768) {
        navMenu?.classList.remove("active");
        navToggle?.classList.remove("active");
        body.style.overflow = "";

        dropdowns.forEach((dropdown) => {
          dropdown.classList.remove("active");
        });

        userMenu?.classList.remove("active");
      }
    });

    // Close menu when clicking outside
    document.addEventListener("click", function (e) {
      if (window.innerWidth <= 768) {
        if (!navToggle?.contains(e.target) && !navMenu?.contains(e.target)) {
          navMenu?.classList.remove("active");
          navToggle?.classList.remove("active");
          body.style.overflow = "";
        }
      }
    });

    // Keyboard navigation support
    document.addEventListener("keydown", function (e) {
      // Close menu on Escape
      if (e.key === "Escape") {
        if (navMenu?.classList.contains("active")) {
          navMenu.classList.remove("active");
          navToggle?.classList.remove("active");
          body.style.overflow = "";
          navToggle?.focus();
        }

        // Close dropdowns
        dropdowns.forEach((dropdown) => {
          dropdown.classList.remove("active");
        });

        userMenu?.classList.remove("active");
      }
    });

    // Add ARIA attributes
    navToggle?.setAttribute("aria-expanded", "false");
    navMenu?.setAttribute("aria-hidden", "true");
  });
</script>
