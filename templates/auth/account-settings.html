{% extends "base.html" %}
{% block title %}Account Settings - BarberX{% endblock %}

{# Set admin check variable #}
{% set is_admin_user = current_user.is_admin or current_user.tier.name == 'ADMIN' %}
{% set is_enterprise_user = current_user.tier.name in ['ENTERPRISE', 'ADMIN'] %}

{% block content %}
<div class="settings-page">
  <!-- Sidebar Navigation -->
  <aside class="settings-sidebar">
    <div class="sidebar-header">
      <div class="user-avatar {% if is_admin_user %}admin{% endif %}">
        {{ current_user.full_name[0].upper() if current_user.full_name else current_user.email[0].upper() }}
      </div>
      <div class="user-info">
        <h3>{{ current_user.full_name or 'User' }}</h3>
        <span class="tier-pill {% if is_admin_user %}admin{% elif is_enterprise_user %}enterprise{% endif %}">
          {% if is_admin_user %}
          <i class="fas fa-shield-alt"></i> Administrator
          {% elif is_enterprise_user %}
          <i class="fas fa-building"></i> Enterprise
          {% else %}
          <i class="fas fa-user"></i> {{ current_user.tier_name }}
          {% endif %}
        </span>
      </div>
    </div>

    <nav class="settings-nav">
      <a href="#profile" class="nav-item active" data-section="profile">
        <i class="fas fa-user"></i>
        <span>Profile</span>
      </a>
      <a href="#security" class="nav-item" data-section="security">
        <i class="fas fa-lock"></i>
        <span>Security</span>
      </a>
      <a href="#notifications" class="nav-item" data-section="notifications">
        <i class="fas fa-bell"></i>
        <span>Notifications</span>
      </a>
      {% if not is_admin_user %}
      <a href="#subscription" class="nav-item" data-section="subscription">
        <i class="fas fa-credit-card"></i>
        <span>Subscription</span>
      </a>
      {% endif %}
      <a href="#usage" class="nav-item" data-section="usage">
        <i class="fas fa-chart-bar"></i>
        <span>Usage</span>
      </a>
      <a href="#privacy" class="nav-item" data-section="privacy">
        <i class="fas fa-shield-alt"></i>
        <span>Privacy</span>
      </a>
      {% if is_admin_user %}
      <div class="nav-divider"></div>
      <a href="#admin" class="nav-item admin-nav" data-section="admin">
        <i class="fas fa-cog"></i>
        <span>Admin Panel</span>
      </a>
      {% endif %}
    </nav>

    <div class="sidebar-footer">
      <a href="/auth/dashboard" class="back-link">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Dashboard</span>
      </a>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="settings-content">
    <!-- Profile Section -->
    <section id="profile" class="settings-section active">
      <div class="section-header">
        <h2><i class="fas fa-user"></i> Profile Information</h2>
        <p>Manage your personal information and preferences</p>
      </div>

      <div class="settings-card">
        <form id="profileForm" class="settings-form">
          <div class="form-row">
            <div class="form-group">
              <label>Full Name</label>
              <input type="text" id="fullName" value="{{ current_user.full_name or '' }}" placeholder="Enter your name">
            </div>
            <div class="form-group">
              <label>Email Address</label>
              <input type="email" id="email" value="{{ current_user.email }}" disabled>
              <span class="input-hint">Contact support to change email</span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Organization</label>
              <input type="text" id="organization" value="{{ current_user.organization or '' }}" placeholder="Law firm or company">
            </div>
            <div class="form-group">
              <label>Phone Number</label>
              <input type="tel" id="phone" placeholder="(555) 123-4567">
            </div>
          </div>

          <div class="form-group">
            <label>Bio</label>
            <textarea id="bio" rows="3" placeholder="Brief description about yourself or your practice"></textarea>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- Security Section -->
    <section id="security" class="settings-section">
      <div class="section-header">
        <h2><i class="fas fa-lock"></i> Security Settings</h2>
        <p>Keep your account safe and secure</p>
      </div>

      <div class="settings-card">
        <div class="security-item">
          <div class="security-icon">
            <i class="fas fa-key"></i>
          </div>
          <div class="security-info">
            <h4>Password</h4>
            <p>Last changed 30 days ago</p>
          </div>
          <button class="btn-secondary" onclick="showChangePassword()">
            Change Password
          </button>
        </div>

        <div class="security-item">
          <div class="security-icon">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <div class="security-info">
            <h4>Two-Factor Authentication</h4>
            <p>Add extra security to your account</p>
          </div>
          <button class="btn-secondary" onclick="setup2FA()">
            Enable 2FA
          </button>
        </div>

        <div class="security-item">
          <div class="security-icon">
            <i class="fas fa-desktop"></i>
          </div>
          <div class="security-info">
            <h4>Active Sessions</h4>
            <p>Manage devices logged into your account</p>
          </div>
          <button class="btn-secondary" onclick="showSessions()">
            View Sessions
          </button>
        </div>

        <div class="security-item">
          <div class="security-icon">
            <i class="fas fa-code"></i>
          </div>
          <div class="security-info">
            <h4>API Keys</h4>
            <p>Manage API access for integrations</p>
          </div>
          <a href="/api-keys" class="btn-secondary">
            Manage Keys
          </a>
        </div>
      </div>
    </section>

    <!-- Notifications Section -->
    <section id="notifications" class="settings-section">
      <div class="section-header">
        <h2><i class="fas fa-bell"></i> Notification Preferences</h2>
        <p>Control how you receive updates</p>
      </div>

      <div class="settings-card">
        <div class="toggle-item">
          <div class="toggle-info">
            <h4>Email Notifications</h4>
            <p>Receive important updates via email</p>
          </div>
          <label class="toggle">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-item">
          <div class="toggle-info">
            <h4>Analysis Complete</h4>
            <p>Get notified when evidence analysis finishes</p>
          </div>
          <label class="toggle">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-item">
          <div class="toggle-info">
            <h4>Document Ready</h4>
            <p>Alert when documents are generated</p>
          </div>
          <label class="toggle">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-item">
          <div class="toggle-info">
            <h4>Compliance Alerts</h4>
            <p>Critical compliance and deadline reminders</p>
          </div>
          <label class="toggle">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-item">
          <div class="toggle-info">
            <h4>Product Updates</h4>
            <p>New features and improvements</p>
          </div>
          <label class="toggle">
            <input type="checkbox">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </section>

    {% if not is_admin_user %}
    <!-- Subscription Section -->
    <section id="subscription" class="settings-section">
      <div class="section-header">
        <h2><i class="fas fa-credit-card"></i> Subscription</h2>
        <p>Manage your plan and billing</p>
      </div>

      <div class="subscription-overview">
        <div class="current-plan">
          <div class="plan-badge {% if is_enterprise_user %}enterprise{% endif %}">
            <i class="fas fa-{% if is_enterprise_user %}building{% else %}crown{% endif %}"></i>
          </div>
          <div class="plan-details">
            <span class="plan-label">Current Plan</span>
            <h3>{{ current_user.tier_name }}</h3>
            {% if not is_enterprise_user %}
            <p class="plan-price">${{ current_user.tier_price }}<span>/month</span></p>
            {% else %}
            <p class="plan-price enterprise">Custom Pricing</p>
            {% endif %}
          </div>
        </div>

        {% if current_user.subscription_end %}
        <div class="renewal-info">
          <i class="fas fa-calendar"></i>
          <span>Renews {{ current_user.subscription_end.strftime('%B %d, %Y') }}</span>
        </div>
        {% endif %}
      </div>

      <div class="subscription-actions">
        {% if not is_enterprise_user %}
        <a href="/pricing" class="btn-primary">
          <i class="fas fa-arrow-up"></i> Upgrade Plan
        </a>
        {% endif %}
        <a href="/billing" class="btn-secondary">
          <i class="fas fa-file-invoice"></i> Billing History
        </a>
      </div>
    </section>
    {% endif %}

    <!-- Usage Section -->
    <section id="usage" class="settings-section">
      <div class="section-header">
        <h2><i class="fas fa-chart-bar"></i> Usage Statistics</h2>
        <p>Track your resource consumption this month</p>
      </div>

      <div class="usage-grid">
        <div class="usage-card">
          <div class="usage-icon"><i class="fas fa-video"></i></div>
          <div class="usage-details">
            <span class="usage-label">Evidence Processed</span>
            <div class="usage-numbers">
              <strong>{{ usage.bwc_videos_processed or 0 }}</strong>
              <span>/ {% if limits.bwc_videos_per_month == -1 %}∞{% else %}{{ limits.bwc_videos_per_month }}{% endif %}</span>
            </div>
            <div class="usage-bar">
              <div class="usage-fill" style="width: {% if limits.bwc_videos_per_month > 0 %}{{ [(usage.bwc_videos_processed or 0) / limits.bwc_videos_per_month * 100, 100] | min }}{% else %}0{% endif %}%"></div>
            </div>
          </div>
        </div>

        <div class="usage-card">
          <div class="usage-icon"><i class="fas fa-file-alt"></i></div>
          <div class="usage-details">
            <span class="usage-label">Documents Analyzed</span>
            <div class="usage-numbers">
              <strong>{{ usage.document_pages_processed or 0 }}</strong>
              <span>/ {% if limits.document_pages_per_month == -1 %}∞{% else %}{{ limits.document_pages_per_month }}{% endif %}</span>
            </div>
            <div class="usage-bar">
              <div class="usage-fill" style="width: {% if limits.document_pages_per_month > 0 %}{{ [(usage.document_pages_processed or 0) / limits.document_pages_per_month * 100, 100] | min }}{% else %}0{% endif %}%"></div>
            </div>
          </div>
        </div>

        <div class="usage-card">
          <div class="usage-icon"><i class="fas fa-robot"></i></div>
          <div class="usage-details">
            <span class="usage-label">AI Requests</span>
            <div class="usage-numbers">
              <strong>{{ usage.api_calls_made or 0 }}</strong>
              <span>/ {% if limits.search_queries_per_month == -1 %}∞{% else %}{{ limits.search_queries_per_month }}{% endif %}</span>
            </div>
            <div class="usage-bar">
              <div class="usage-fill" style="width: {% if limits.search_queries_per_month > 0 %}{{ [(usage.api_calls_made or 0) / limits.search_queries_per_month * 100, 100] | min }}{% else %}0{% endif %}%"></div>
            </div>
          </div>
        </div>

        <div class="usage-card">
          <div class="usage-icon"><i class="fas fa-hdd"></i></div>
          <div class="usage-details">
            <span class="usage-label">Storage Used</span>
            <div class="usage-numbers">
              <strong>{{ ((usage.storage_used_mb or 0) / 1024) | round(2) }} GB</strong>
              <span>/ {% if limits.storage_gb == -1 %}∞{% else %}{{ limits.storage_gb }}{% endif %} GB</span>
            </div>
            <div class="usage-bar">
              <div class="usage-fill" style="width: {% if limits.storage_gb > 0 %}{{ [((usage.storage_used_mb or 0) / 1024) / limits.storage_gb * 100, 100] | min }}{% else %}0{% endif %}%"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Privacy Section -->
    <section id="privacy" class="settings-section">
      <div class="section-header">
        <h2><i class="fas fa-shield-alt"></i> Data & Privacy</h2>
        <p>Manage your data and account</p>
      </div>

      <div class="settings-card">
        <div class="privacy-item">
          <div class="privacy-icon">
            <i class="fas fa-download"></i>
          </div>
          <div class="privacy-info">
            <h4>Export Your Data</h4>
            <p>Download a copy of all your account data</p>
          </div>
          <button class="btn-secondary" onclick="requestDataExport()">
            Request Export
          </button>
        </div>

        <div class="privacy-item">
          <div class="privacy-icon">
            <i class="fas fa-file-contract"></i>
          </div>
          <div class="privacy-info">
            <h4>Privacy Policy</h4>
            <p>Read how we handle your data</p>
          </div>
          <a href="/privacy" class="btn-secondary">
            View Policy
          </a>
        </div>

        {% if not is_admin_user %}
        <div class="privacy-item danger">
          <div class="privacy-icon">
            <i class="fas fa-trash-alt"></i>
          </div>
          <div class="privacy-info">
            <h4>Delete Account</h4>
            <p>Permanently remove your account and all data</p>
          </div>
          <button class="btn-danger" onclick="showDeleteAccount()">
            Delete Account
          </button>
        </div>
        {% else %}
        <div class="privacy-item protected">
          <div class="privacy-icon">
            <i class="fas fa-lock"></i>
          </div>
          <div class="privacy-info">
            <h4>Account Protected</h4>
            <p>Administrator accounts cannot be self-deleted</p>
          </div>
          <span class="protected-badge">Protected</span>
        </div>
        {% endif %}
      </div>
    </section>

    {% if is_admin_user %}
    <!-- Admin Section -->
    <section id="admin" class="settings-section">
      <div class="section-header admin-header">
        <h2><i class="fas fa-cog"></i> Administrator Controls</h2>
        <p>System management and configuration</p>
      </div>

      <div class="admin-grid">
        <a href="/admin" class="admin-card">
          <div class="admin-icon">
            <i class="fas fa-tachometer-alt"></i>
          </div>
          <h4>Dashboard</h4>
          <p>System overview and metrics</p>
        </a>

        <a href="/admin/users" class="admin-card">
          <div class="admin-icon">
            <i class="fas fa-users"></i>
          </div>
          <h4>User Management</h4>
          <p>View and manage all users</p>
        </a>

        <a href="/admin/logs" class="admin-card">
          <div class="admin-icon">
            <i class="fas fa-clipboard-list"></i>
          </div>
          <h4>Audit Logs</h4>
          <p>System activity and events</p>
        </a>

        <a href="/admin/settings" class="admin-card">
          <div class="admin-icon">
            <i class="fas fa-sliders-h"></i>
          </div>
          <h4>Platform Settings</h4>
          <p>Configure global options</p>
        </a>

        <a href="/admin/analytics" class="admin-card">
          <div class="admin-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <h4>Analytics</h4>
          <p>Usage trends and insights</p>
        </a>

        <a href="/admin/billing" class="admin-card">
          <div class="admin-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <h4>Billing Admin</h4>
          <p>Revenue and subscriptions</p>
        </a>
      </div>
    </section>
    {% endif %}
  </main>
</div>

<!-- Change Password Modal -->
<div class="modal-overlay" id="passwordModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-key"></i> Change Password</h3>
      <button class="modal-close" onclick="closeModal('passwordModal')">&times;</button>
    </div>
    <form id="changePasswordForm">
      <div class="form-group">
        <label>Current Password</label>
        <input type="password" id="currentPassword" required>
      </div>
      <div class="form-group">
        <label>New Password</label>
        <input type="password" id="newPassword" required>
        <span class="input-hint">Min 8 chars, include uppercase, lowercase, and numbers</span>
      </div>
      <div class="form-group">
        <label>Confirm New Password</label>
        <input type="password" id="confirmPassword" required>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('passwordModal')">Cancel</button>
        <button type="submit" class="btn-primary">Update Password</button>
      </div>
    </form>
  </div>
</div>

<script>
// Section Navigation
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', function(e) {
    e.preventDefault();
    const section = this.dataset.section;
    
    // Update nav
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    this.classList.add('active');
    
    // Update sections
    document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
    document.getElementById(section).classList.add('active');
  });
});

// Profile Form
document.getElementById('profileForm')?.addEventListener('submit', async function(e) {
  e.preventDefault();
  const data = {
    full_name: document.getElementById('fullName').value,
    organization: document.getElementById('organization').value,
    phone: document.getElementById('phone').value,
    bio: document.getElementById('bio').value
  };
  
  try {
    const response = await fetch('/api/user/profile', {
      method: 'PUT',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    
    if (response.ok) {
      showToast('Profile updated successfully', 'success');
    } else {
      showToast('Failed to update profile', 'error');
    }
  } catch (error) {
    showToast('Error updating profile', 'error');
  }
});

// Password Change
function showChangePassword() {
  document.getElementById('passwordModal').classList.add('active');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('active');
}

document.getElementById('changePasswordForm')?.addEventListener('submit', async function(e) {
  e.preventDefault();
  const current = document.getElementById('currentPassword').value;
  const newPass = document.getElementById('newPassword').value;
  const confirm = document.getElementById('confirmPassword').value;
  
  if (newPass !== confirm) {
    showToast('Passwords do not match', 'error');
    return;
  }
  
  try {
    const response = await fetch('/api/user/change-password', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ current_password: current, new_password: newPass })
    });
    
    if (response.ok) {
      showToast('Password changed successfully', 'success');
      closeModal('passwordModal');
      this.reset();
    } else {
      showToast('Failed to change password', 'error');
    }
  } catch (error) {
    showToast('Error changing password', 'error');
  }
});

function setup2FA() {
  showToast('2FA setup coming soon!', 'info');
}

function showSessions() {
  showToast('Session management coming soon!', 'info');
}

function requestDataExport() {
  if (confirm('Request a full export of your data? You will receive an email when ready.')) {
    fetch('/api/user/export-data', { method: 'POST' })
      .then(() => showToast('Export requested. Check your email.', 'success'))
      .catch(() => showToast('Error requesting export', 'error'));
  }
}

function showDeleteAccount() {
  if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
    if (confirm('Final confirmation: Delete all your data permanently?')) {
      fetch('/api/user/delete-account', { method: 'DELETE' })
        .then(() => {
          showToast('Account deleted', 'success');
          setTimeout(() => window.location.href = '/', 2000);
        })
        .catch(() => showToast('Error deleting account', 'error'));
    }
  }
}

function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle"></i> ${message}`;
  document.body.appendChild(toast);
  setTimeout(() => toast.classList.add('show'), 10);
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}
</script>

<style>
/* Settings Page Layout */
.settings-page {
  display: flex;
  min-height: 100vh;
  background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
}

/* Sidebar */
.settings-sidebar {
  width: 280px;
  background: rgba(255,255,255,0.03);
  border-right: 1px solid rgba(255,255,255,0.08);
  display: flex;
  flex-direction: column;
  position: sticky;
  top: 0;
  height: 100vh;
}

.sidebar-header {
  padding: 2rem;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  text-align: center;
}

.user-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 2rem;
  font-weight: 700;
  margin: 0 auto 1rem;
  border: 3px solid rgba(255,255,255,0.1);
}

.user-avatar.admin {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
}

.user-info h3 {
  font-size: 1.1rem;
  margin-bottom: 0.5rem;
  color: #fff;
}

.tier-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.35rem 0.8rem;
  background: rgba(99, 102, 241, 0.2);
  border: 1px solid rgba(99, 102, 241, 0.3);
  border-radius: 20px;
  font-size: 0.75rem;
  color: #818cf8;
}

.tier-pill.admin {
  background: rgba(245, 158, 11, 0.2);
  border-color: rgba(245, 158, 11, 0.3);
  color: #fbbf24;
}

.tier-pill.enterprise {
  background: rgba(16, 185, 129, 0.2);
  border-color: rgba(16, 185, 129, 0.3);
  color: #34d399;
}

/* Navigation */
.settings-nav {
  flex: 1;
  padding: 1rem;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.85rem 1rem;
  color: #9ca3af;
  text-decoration: none;
  border-radius: 10px;
  margin-bottom: 0.25rem;
  transition: all 0.2s;
}

.nav-item:hover {
  background: rgba(255,255,255,0.05);
  color: #fff;
}

.nav-item.active {
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
  color: #fff;
  border-left: 3px solid #8b5cf6;
}

.nav-item i {
  width: 20px;
  text-align: center;
}

.nav-divider {
  height: 1px;
  background: rgba(255,255,255,0.08);
  margin: 1rem 0;
}

.nav-item.admin-nav {
  color: #fbbf24;
}

.nav-item.admin-nav.active {
  background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
  border-left-color: #f59e0b;
}

.sidebar-footer {
  padding: 1rem;
  border-top: 1px solid rgba(255,255,255,0.08);
}

.back-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  color: #9ca3af;
  text-decoration: none;
  border-radius: 8px;
  transition: all 0.2s;
}

.back-link:hover {
  background: rgba(255,255,255,0.05);
  color: #fff;
}

/* Main Content */
.settings-content {
  flex: 1;
  padding: 2rem 3rem;
  max-width: 900px;
}

.settings-section {
  display: none;
}

.settings-section.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.section-header {
  margin-bottom: 2rem;
}

.section-header h2 {
  font-size: 1.5rem;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.section-header h2 i {
  color: #8b5cf6;
}

.section-header p {
  color: #9ca3af;
  font-size: 0.9rem;
}

.section-header.admin-header h2 i {
  color: #f59e0b;
}

/* Settings Card */
.settings-card {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  padding: 1.5rem;
}

/* Forms */
.settings-form .form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  color: #e5e7eb;
  font-size: 0.875rem;
  font-weight: 500;
  margin-bottom: 0.5rem;
}

.form-group input,
.form-group textarea {
  width: 100%;
  padding: 0.75rem 1rem;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 10px;
  color: #fff;
  font-size: 0.95rem;
  transition: all 0.2s;
}

.form-group input:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #8b5cf6;
  box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

.form-group input:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.input-hint {
  font-size: 0.75rem;
  color: #6b7280;
  margin-top: 0.25rem;
  display: block;
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  padding-top: 1rem;
  border-top: 1px solid rgba(255,255,255,0.08);
  margin-top: 1rem;
}

/* Buttons */
.btn-primary {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  border-radius: 10px;
  color: #fff;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 1.2rem;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  color: #e5e7eb;
  font-size: 0.875rem;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.2s;
}

.btn-secondary:hover {
  background: rgba(255,255,255,0.1);
  color: #fff;
}

.btn-danger {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 1.2rem;
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 8px;
  color: #f87171;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-danger:hover {
  background: rgba(239, 68, 68, 0.2);
}

/* Security Items */
.security-item,
.privacy-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.25rem 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.security-item:last-child,
.privacy-item:last-child {
  border-bottom: none;
}

.security-icon,
.privacy-icon {
  width: 45px;
  height: 45px;
  background: rgba(139, 92, 246, 0.1);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #8b5cf6;
  font-size: 1.1rem;
}

.security-info,
.privacy-info {
  flex: 1;
}

.security-info h4,
.privacy-info h4 {
  color: #fff;
  font-size: 0.95rem;
  margin-bottom: 0.25rem;
}

.security-info p,
.privacy-info p {
  color: #9ca3af;
  font-size: 0.8rem;
  margin: 0;
}

.privacy-item.danger .privacy-icon {
  background: rgba(239, 68, 68, 0.1);
  color: #f87171;
}

.privacy-item.protected .privacy-icon {
  background: rgba(245, 158, 11, 0.1);
  color: #fbbf24;
}

.protected-badge {
  padding: 0.4rem 0.8rem;
  background: rgba(245, 158, 11, 0.1);
  border: 1px solid rgba(245, 158, 11, 0.3);
  border-radius: 6px;
  color: #fbbf24;
  font-size: 0.75rem;
  font-weight: 500;
}

/* Toggle Items */
.toggle-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.toggle-item:last-child {
  border-bottom: none;
}

.toggle-info h4 {
  color: #fff;
  font-size: 0.9rem;
  margin-bottom: 0.2rem;
}

.toggle-info p {
  color: #9ca3af;
  font-size: 0.8rem;
  margin: 0;
}

.toggle {
  position: relative;
  width: 48px;
  height: 26px;
}

.toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255,255,255,0.1);
  border-radius: 26px;
  transition: 0.3s;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 3px;
  background: #fff;
  border-radius: 50%;
  transition: 0.3s;
}

.toggle input:checked + .toggle-slider {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.toggle input:checked + .toggle-slider:before {
  transform: translateX(22px);
}

/* Subscription */
.subscription-overview {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  padding: 2rem;
  margin-bottom: 1.5rem;
}

.current-plan {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.plan-badge {
  width: 70px;
  height: 70px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  color: #fff;
}

.plan-badge.enterprise {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.plan-label {
  font-size: 0.75rem;
  color: #9ca3af;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.plan-details h3 {
  font-size: 1.5rem;
  color: #fff;
  margin: 0.25rem 0;
}

.plan-price {
  font-size: 1.25rem;
  color: #8b5cf6;
  font-weight: 600;
}

.plan-price span {
  font-size: 0.875rem;
  color: #9ca3af;
  font-weight: 400;
}

.plan-price.enterprise {
  color: #34d399;
}

.renewal-info {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(255,255,255,0.08);
  color: #9ca3af;
  font-size: 0.875rem;
}

.subscription-actions {
  display: flex;
  gap: 1rem;
}

/* Usage Grid */
.usage-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

.usage-card {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 12px;
  padding: 1.25rem;
  display: flex;
  gap: 1rem;
}

.usage-icon {
  width: 45px;
  height: 45px;
  background: rgba(139, 92, 246, 0.1);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #8b5cf6;
  font-size: 1.1rem;
  flex-shrink: 0;
}

.usage-details {
  flex: 1;
  min-width: 0;
}

.usage-label {
  font-size: 0.75rem;
  color: #9ca3af;
  display: block;
  margin-bottom: 0.25rem;
}

.usage-numbers {
  display: flex;
  align-items: baseline;
  gap: 0.25rem;
  margin-bottom: 0.5rem;
}

.usage-numbers strong {
  font-size: 1.25rem;
  color: #fff;
}

.usage-numbers span {
  font-size: 0.8rem;
  color: #6b7280;
}

.usage-bar {
  height: 6px;
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
  overflow: hidden;
}

.usage-fill {
  height: 100%;
  background: linear-gradient(90deg, #667eea 0%, #8b5cf6 100%);
  border-radius: 3px;
  transition: width 0.3s;
}

/* Admin Grid */
.admin-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

.admin-card {
  background: rgba(245, 158, 11, 0.05);
  border: 1px solid rgba(245, 158, 11, 0.15);
  border-radius: 12px;
  padding: 1.5rem;
  text-decoration: none;
  text-align: center;
  transition: all 0.2s;
}

.admin-card:hover {
  background: rgba(245, 158, 11, 0.1);
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(245, 158, 11, 0.1);
}

.admin-icon {
  width: 50px;
  height: 50px;
  background: rgba(245, 158, 11, 0.1);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fbbf24;
  font-size: 1.25rem;
  margin: 0 auto 1rem;
}

.admin-card h4 {
  color: #fff;
  font-size: 0.95rem;
  margin-bottom: 0.25rem;
}

.admin-card p {
  color: #9ca3af;
  font-size: 0.75rem;
  margin: 0;
}

/* Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s;
  z-index: 1000;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: #1a1a2e;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 16px;
  width: 100%;
  max-width: 420px;
  transform: scale(0.9);
  transition: transform 0.3s;
}

.modal-overlay.active .modal-content {
  transform: scale(1);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.modal-header h3 {
  font-size: 1.1rem;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.modal-header h3 i {
  color: #8b5cf6;
}

.modal-close {
  background: none;
  border: none;
  color: #9ca3af;
  font-size: 1.5rem;
  cursor: pointer;
  line-height: 1;
}

.modal-close:hover {
  color: #fff;
}

.modal-content form {
  padding: 1.5rem;
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  padding-top: 1rem;
  border-top: 1px solid rgba(255,255,255,0.08);
  margin-top: 0.5rem;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  padding: 1rem 1.5rem;
  background: #1a1a2e;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 10px;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.3s;
  z-index: 1001;
}

.toast.show {
  transform: translateY(0);
  opacity: 1;
}

.toast-success {
  border-color: rgba(16, 185, 129, 0.3);
}

.toast-success i {
  color: #34d399;
}

.toast-error {
  border-color: rgba(239, 68, 68, 0.3);
}

.toast-error i {
  color: #f87171;
}

.toast-info i {
  color: #60a5fa;
}

/* Responsive */
@media (max-width: 1024px) {
  .settings-page {
    flex-direction: column;
  }
  
  .settings-sidebar {
    width: 100%;
    height: auto;
    position: relative;
  }
  
  .settings-nav {
    display: flex;
    overflow-x: auto;
    padding: 0.5rem 1rem;
  }
  
  .nav-item {
    white-space: nowrap;
    margin-bottom: 0;
    margin-right: 0.25rem;
  }
  
  .nav-divider {
    display: none;
  }
  
  .sidebar-footer {
    display: none;
  }
  
  .settings-content {
    padding: 1.5rem;
  }
  
  .settings-form .form-row {
    grid-template-columns: 1fr;
  }
  
  .usage-grid {
    grid-template-columns: 1fr;
  }
  
  .admin-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 640px) {
  .admin-grid {
    grid-template-columns: 1fr;
  }
  
  .subscription-actions {
    flex-direction: column;
  }
  
  .current-plan {
    flex-direction: column;
    text-align: center;
  }
}
</style>
{% endblock %}
