<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Evidence Dashboard | BarberX Legal Tech</title>
  <link rel="stylesheet" href="/assets/css/legal-tech-platform.css">
  <style>
    body {
      background: #f8f9fa;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .dashboard-header {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      color: white;
      padding: 1.5rem 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-title h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    
    .header-title p {
      margin: 0.25rem 0 0 0;
      opacity: 0.9;
      font-size: 0.875rem;
    }
    
    .header-actions {
      display: flex;
      gap: 1rem;
    }
    
    .btn {
      padding: 0.625rem 1.25rem;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }
    
    .btn-primary {
      background: white;
      color: #1e3a8a;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 255, 255, 0.3);
    }
    
    .btn-outline {
      background: transparent;
      color: white;
      border: 2px solid white;
    }
    
    .btn-outline:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .dashboard-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      border-left: 4px solid;
    }
    
    .stat-card.total {
      border-left-color: #3b82f6;
    }
    
    .stat-card.processing {
      border-left-color: #f59e0b;
    }
    
    .stat-card.completed {
      border-left-color: #10b981;
    }
    
    .stat-card.overdue {
      border-left-color: #ef4444;
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 0.25rem;
    }
    
    .stat-change {
      font-size: 0.8125rem;
      color: #10b981;
    }
    
    .workflow-pipeline {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .pipeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .pipeline-header h2 {
      margin: 0;
      font-size: 1.25rem;
      color: #1e293b;
    }
    
    .pipeline-stages {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1rem;
    }
    
    .pipeline-stage {
      text-align: center;
      position: relative;
    }
    
    .stage-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #f1f5f9;
      color: #94a3b8;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.75rem;
      font-size: 1.5rem;
      font-weight: 700;
      border: 3px solid #e2e8f0;
      transition: all 0.3s;
    }
    
    .pipeline-stage.active .stage-icon {
      background: #dbeafe;
      color: #3b82f6;
      border-color: #3b82f6;
    }
    
    .pipeline-stage.completed .stage-icon {
      background: #d1fae5;
      color: #10b981;
      border-color: #10b981;
    }
    
    .stage-name {
      font-size: 0.8125rem;
      color: #64748b;
      font-weight: 600;
    }
    
    .stage-count {
      font-size: 0.75rem;
      color: #94a3b8;
      margin-top: 0.25rem;
    }
    
    .evidence-list {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .list-header {
      padding: 1.5rem 2rem;
      border-bottom: 2px solid #f1f5f9;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .list-header h2 {
      margin: 0;
      font-size: 1.25rem;
      color: #1e293b;
    }
    
    .list-filters {
      display: flex;
      gap: 0.75rem;
    }
    
    .filter-btn {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      border: 2px solid #e5e7eb;
      background: white;
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .filter-btn.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .evidence-table {
      width: 100%;
    }
    
    .evidence-row {
      border-bottom: 1px solid #f1f5f9;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .evidence-row:hover {
      background: #f8fafc;
    }
    
    .evidence-row td {
      padding: 1.25rem 2rem;
    }
    
    .evidence-id {
      font-family: 'Courier New', monospace;
      font-weight: 600;
      color: #3b82f6;
    }
    
    .evidence-case {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 0.25rem;
    }
    
    .evidence-description {
      font-size: 0.8125rem;
      color: #64748b;
    }
    
    .stage-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.875rem;
      border-radius: 16px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stage-badge.intake {
      background: #e0e7ff;
      color: #4338ca;
    }
    
    .stage-badge.verification {
      background: #dbeafe;
      color: #1e40af;
    }
    
    .stage-badge.analysis {
      background: #fef3c7;
      color: #92400e;
    }
    
    .stage-badge.review {
      background: #fed7aa;
      color: #9a3412;
    }
    
    .stage-badge.approved {
      background: #d1fae5;
      color: #065f46;
    }
    
    .priority-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.8125rem;
      font-weight: 600;
    }
    
    .priority-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .priority-indicator.critical .priority-dot {
      background: #ef4444;
    }
    
    .priority-indicator.high .priority-dot {
      background: #f59e0b;
    }
    
    .priority-indicator.normal .priority-dot {
      background: #3b82f6;
    }
    
    .priority-indicator.low .priority-dot {
      background: #94a3b8;
    }
    
    .sla-timer {
      font-size: 0.8125rem;
      font-family: 'Courier New', monospace;
      font-weight: 600;
    }
    
    .sla-timer.on-track {
      color: #10b981;
    }
    
    .sla-timer.at-risk {
      color: #f59e0b;
    }
    
    .sla-timer.overdue {
      color: #ef4444;
    }
    
    .action-menu {
      position: relative;
    }
    
    .action-btn {
      padding: 0.5rem;
      background: none;
      border: none;
      cursor: pointer;
      color: #6b7280;
      font-size: 1.25rem;
    }
    
    .action-btn:hover {
      color: #1e293b;
    }
  </style>
</head>
<body>
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-title">
        <h1>üî¨ Evidence Processing Dashboard</h1>
        <p>Track and manage evidence through the complete forensic workflow</p>
      </div>
      <div class="header-actions">
        <a href="/evidence/intake" class="btn btn-primary">
          <span>+</span> New Evidence Intake
        </a>
        <button class="btn btn-outline" onclick="toggleTerminal()">
          <span>‚åò</span> Terminal
        </button>
      </div>
    </div>
  </div>
  
  <div class="dashboard-container">
    <!-- Statistics -->
    <div class="stats-grid">
      <div class="stat-card total">
        <div class="stat-label">Total Evidence</div>
        <div class="stat-value" id="statTotal">0</div>
        <div class="stat-change">+0 this week</div>
      </div>
      
      <div class="stat-card processing">
        <div class="stat-label">In Processing</div>
        <div class="stat-value" id="statProcessing">0</div>
        <div class="stat-change">Across all stages</div>
      </div>
      
      <div class="stat-card completed">
        <div class="stat-label">Completed</div>
        <div class="stat-value" id="statCompleted">0</div>
        <div class="stat-change">Ready for court</div>
      </div>
      
      <div class="stat-card overdue">
        <div class="stat-label">SLA At Risk</div>
        <div class="stat-value" id="statOverdue">0</div>
        <div class="stat-change">Needs attention</div>
      </div>
    </div>
    
    <!-- Processing Pipeline -->
    <div class="workflow-pipeline">
      <div class="pipeline-header">
        <h2>Processing Pipeline</h2>
      </div>
      
      <div class="pipeline-stages">
        <div class="pipeline-stage completed">
          <div class="stage-icon">‚úì</div>
          <div class="stage-name">Intake</div>
          <div class="stage-count" id="countIntake">0 items</div>
        </div>
        
        <div class="pipeline-stage active">
          <div class="stage-icon">üîç</div>
          <div class="stage-name">Verification</div>
          <div class="stage-count" id="countVerification">0 items</div>
        </div>
        
        <div class="pipeline-stage">
          <div class="stage-icon">üìã</div>
          <div class="stage-name">Metadata</div>
          <div class="stage-count" id="countMetadata">0 items</div>
        </div>
        
        <div class="pipeline-stage">
          <div class="stage-icon">üéØ</div>
          <div class="stage-name">Analysis</div>
          <div class="stage-count" id="countAnalysis">0 items</div>
        </div>
        
        <div class="pipeline-stage">
          <div class="stage-icon">‚ö°</div>
          <div class="stage-name">Enhancement</div>
          <div class="stage-count" id="countEnhancement">0 items</div>
        </div>
        
        <div class="pipeline-stage">
          <div class="stage-icon">üëÅÔ∏è</div>
          <div class="stage-name">Review</div>
          <div class="stage-count" id="countReview">0 items</div>
        </div>
        
        <div class="pipeline-stage">
          <div class="stage-icon">‚öñÔ∏è</div>
          <div class="stage-name">Approved</div>
          <div class="stage-count" id="countApproved">0 items</div>
        </div>
      </div>
    </div>
    
    <!-- Evidence List -->
    <div class="evidence-list">
      <div class="list-header">
        <h2>Evidence Items</h2>
        <div class="list-filters">
          <button class="filter-btn active" onclick="filterEvidence('all')">All</button>
          <button class="filter-btn" onclick="filterEvidence('critical')">Critical</button>
          <button class="filter-btn" onclick="filterEvidence('overdue')">Overdue</button>
          <button class="filter-btn" onclick="filterEvidence('my')">Assigned to Me</button>
        </div>
      </div>
      
      <table class="evidence-table">
        <tbody id="evidenceTableBody">
          <!-- Evidence rows will be inserted here -->
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Terminal Component -->
  {% include 'components/terminal.html' %}
  
  <script>
    let evidenceData = [];
    
    async function loadEvidence() {
      try {
        const response = await fetch('/api/evidence/list');
        evidenceData = await response.json();
        
        updateStats();
        updatePipeline();
        renderEvidenceList();
      } catch (error) {
        console.error('Error loading evidence:', error);
      }
    }
    
    function updateStats() {
      document.getElementById('statTotal').textContent = evidenceData.length;
      
      const processing = evidenceData.filter(e => 
        !['approved', 'archived'].includes(e.processing_status.stage)
      ).length;
      document.getElementById('statProcessing').textContent = processing;
      
      const completed = evidenceData.filter(e => 
        e.processing_status.stage === 'approved'
      ).length;
      document.getElementById('statCompleted').textContent = completed;
      
      const overdue = evidenceData.filter(e => 
        new Date(e.processing_status.sla_deadline) < new Date()
      ).length;
      document.getElementById('statOverdue').textContent = overdue;
    }
    
    function updatePipeline() {
      const stages = ['intake', 'verification', 'metadata', 'analysis', 'enhancement', 'review', 'approved'];
      
      stages.forEach(stage => {
        const count = evidenceData.filter(e => e.processing_status.stage === stage).length;
        const countEl = document.getElementById(`count${stage.charAt(0).toUpperCase() + stage.slice(1)}`);
        if (countEl) {
          countEl.textContent = `${count} item${count !== 1 ? 's' : ''}`;
        }
      });
    }
    
    function renderEvidenceList() {
      const tbody = document.getElementById('evidenceTableBody');
      tbody.innerHTML = '';
      
      evidenceData.forEach(evidence => {
        const row = createEvidenceRow(evidence);
        tbody.appendChild(row);
      });
    }
    
    function createEvidenceRow(evidence) {
      const tr = document.createElement('tr');
      tr.className = 'evidence-row';
      tr.onclick = () => window.location.href = `/evidence/${evidence.evidence_id}`;
      
      const slaStatus = getSLAStatus(evidence.processing_status.sla_deadline);
      const hoursRemaining = getHoursRemaining(evidence.processing_status.sla_deadline);
      
      tr.innerHTML = `
        <td>
          <div class="evidence-id">${evidence.evidence_id}</div>
        </td>
        <td>
          <div class="evidence-case">${evidence.case_information.case_number}</div>
          <div class="evidence-description">${evidence.evidence_details.description.substring(0, 60)}...</div>
        </td>
        <td>
          <span class="stage-badge ${evidence.processing_status.stage}">
            ${evidence.processing_status.stage.replace('_', ' ')}
          </span>
        </td>
        <td>
          <div class="priority-indicator ${evidence.processing_status.priority}">
            <div class="priority-dot"></div>
            ${evidence.processing_status.priority}
          </div>
        </td>
        <td>
          <div class="sla-timer ${slaStatus}">
            ${hoursRemaining >= 0 ? `${Math.floor(hoursRemaining)}h remaining` : 'OVERDUE'}
          </div>
        </td>
        <td>
          <div class="action-menu">
            <button class="action-btn" onclick="event.stopPropagation(); openActionMenu('${evidence.evidence_id}')">‚ãÆ</button>
          </div>
        </td>
      `;
      
      return tr;
    }
    
    function getSLAStatus(deadline) {
      const hours = getHoursRemaining(deadline);
      if (hours < 0) return 'overdue';
      if (hours < 4) return 'at-risk';
      return 'on-track';
    }
    
    function getHoursRemaining(deadline) {
      const now = new Date();
      const sla = new Date(deadline);
      return (sla - now) / (1000 * 60 * 60);
    }
    
    function filterEvidence(filter) {
      // Update active button
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Filter logic would go here
      renderEvidenceList();
    }
    
    function openActionMenu(evidenceId) {
      console.log('Open actions for:', evidenceId);
      // Action menu logic
    }
    
    // Load data on page load
    loadEvidence();
    
    // Refresh every 30 seconds
    setInterval(loadEvidence, 30000);
  </script>
</body>
</html>
